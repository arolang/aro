<!DOCTYPE html>
<html lang="en">
<head>
    <title>Events - ARO Programming Language</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//matomo.benjamin.ausdertechnik.de/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->

    <style>
        .doc-page {
            padding: 120px 24px 80px;
            max-width: 800px;
            margin: 0 auto;
        }

        .doc-page h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            letter-spacing: -0.02em;
        }

        .doc-page h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 48px 0 16px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .doc-page h3 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 32px 0 12px;
            color: var(--color-secondary);
        }

        .doc-page h4 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 24px 0 10px;
            color: var(--color-text);
        }

        .doc-page p {
            font-size: 1.1rem;
            color: var(--color-text-muted);
            line-height: 1.8;
            margin-bottom: 16px;
        }

        .doc-page code {
            font-family: var(--font-mono);
            background: var(--color-bg-alt);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .doc-page pre {
            background: var(--color-bg-alt);
            border-radius: var(--radius-md);
            padding: 20px;
            overflow-x: auto;
            margin: 24px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .doc-page pre code {
            background: none;
            padding: 0;
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .doc-page ul, .doc-page ol {
            color: var(--color-text-muted);
            margin: 16px 0 16px 24px;
            line-height: 1.8;
        }

        .doc-page li {
            margin-bottom: 8px;
        }

        .doc-page table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
        }

        .doc-page th, .doc-page td {
            padding: 12px 16px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .doc-page th {
            background: var(--color-bg-alt);
            font-weight: 600;
        }

        .doc-page blockquote {
            border-left: 4px solid var(--color-primary);
            padding-left: 20px;
            margin: 24px 0;
            color: var(--color-text);
            font-style: italic;
        }

        .doc-page strong {
            color: var(--color-text);
        }

        .doc-page em {
            color: var(--color-secondary);
        }

        .doc-page a {
            color: var(--color-primary);
            text-decoration: none;
        }

        .doc-page a:hover {
            text-decoration: underline;
        }

        .doc-page hr {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 48px 0;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--color-text-muted);
            text-decoration: none;
            font-size: 0.95rem;
            margin-bottom: 24px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--color-primary);
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-content">
            <a href="/aro/" class="logo">
                <span class="logo-aro">ARO</span>
            </a>
            <div class="nav-links">
                <a href="../../fdd.html">The FDD Story</a>
                <a href="../../getting-started.html">Get Started</a>
                <a href="../../tutorial.html">Tutorial</a>
                <a href="../../docs.html" style="color: var(--color-text);">Docs</a>
                <a href="../../disclaimer.html">Motivation</a>
                <a href="https://github.com/KrisSimon/aro" class="nav-github">GitHub</a>
            </div>
        </div>
    </nav>

    <main class="doc-page">
        <a href="../../docs.html" class="back-link">&#x2190; Back to Documentation</a>
        <h1>Events</h1>
<p>ARO is fundamentally event-driven. Feature sets respond to events rather than being called directly. This chapter explains how events work and how to build event-driven applications.</p>
<h2>Event-Driven Architecture</h2>
<p>In ARO, feature sets are <strong>triggered by events</strong>, not called directly:</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                        Event Bus                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  HTTPRequest ───► (listUsers: User API)  [via operationId] │
│                                                             │
│  FileCreated ───► (Process: FileCreated Handler)           │
│                                                             │
│  ClientConnected ─► (Handle: ClientConnected Handler)      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h2>Event Types</h2>
<h3>HTTP Events (Contract-First)</h3>
<p>ARO uses <strong>contract-first</strong> HTTP development. Routes are defined in <code>openapi.yaml</code>, and feature sets are named after <code>operationId</code> values:</p>
<p><strong>openapi.yaml:</strong></p>
<pre><code class="language-yaml">openapi: 3.0.3
info:
  title: User API
  version: 1.0.0

paths:
  /users:
    get:
      operationId: listUsers
    post:
      operationId: createUser
  /users/{id}:
    get:
      operationId: getUser
</code></pre>
<p><strong>handlers.aro:</strong></p>
<pre><code class="language-aro">(* Triggered by GET /users - matches operationId *)
(listUsers: User API) {
    &lt;Retrieve&gt; the &lt;users&gt; from the &lt;repository&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; with &lt;users&gt;.
}

(* Triggered by POST /users *)
(createUser: User API) {
    &lt;Extract&gt; the &lt;data&gt; from the &lt;request: body&gt;.
    &lt;Create&gt; the &lt;user&gt; with &lt;data&gt;.
    &lt;Return&gt; a &lt;Created: status&gt; with &lt;user&gt;.
}

(* Triggered by GET /users/123 *)
(getUser: User API) {
    &lt;Extract&gt; the &lt;id&gt; from the &lt;pathParameters: id&gt;.
    &lt;Retrieve&gt; the &lt;user&gt; from the &lt;repository&gt; where id = &lt;id&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; with &lt;user&gt;.
}
</code></pre>
<h3>File System Events</h3>
<p>Triggered by file system changes:</p>
<pre><code class="language-aro">(* File created *)
(Process New File: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Read&gt; the &lt;content&gt; from the &lt;file: path&gt;.
    &lt;Process&gt; the &lt;result&gt; from the &lt;content&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;processing&gt;.
}

(* File modified *)
(Reload Config: FileModified Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    if &lt;path&gt; is &quot;./config.json&quot; then {
        &lt;Read&gt; the &lt;config&gt; from the &lt;file: path&gt;.
        &lt;Publish&gt; as &lt;app-config&gt; &lt;config&gt;.
    }
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;reload&gt;.
}

(* File deleted *)
(Log Deletion: FileDeleted Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Log&gt; the &lt;message&gt; for the &lt;console&gt; with &quot;File deleted: ${path}&quot;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;logging&gt;.
}
</code></pre>
<h3>Socket Events</h3>
<p>Triggered by TCP connections:</p>
<pre><code class="language-aro">(* Client connected *)
(Handle Connection: ClientConnected Handler) {
    &lt;Extract&gt; the &lt;client-id&gt; from the &lt;event: connectionId&gt;.
    &lt;Extract&gt; the &lt;address&gt; from the &lt;event: remoteAddress&gt;.
    &lt;Log&gt; the &lt;message&gt; for the &lt;console&gt; with &quot;Client connected: ${address}&quot;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;connection&gt;.
}

(* Data received *)
(Process Data: DataReceived Handler) {
    &lt;Extract&gt; the &lt;data&gt; from the &lt;event: data&gt;.
    &lt;Extract&gt; the &lt;connection&gt; from the &lt;event: connection&gt;.
    &lt;Process&gt; the &lt;response&gt; from the &lt;data&gt;.
    &lt;Send&gt; the &lt;response&gt; to the &lt;connection&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;processing&gt;.
}

(* Client disconnected *)
(Handle Disconnect: ClientDisconnected Handler) {
    &lt;Extract&gt; the &lt;client-id&gt; from the &lt;event: connectionId&gt;.
    &lt;Log&gt; the &lt;message&gt; for the &lt;console&gt; with &quot;Client disconnected: ${client-id}&quot;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;cleanup&gt;.
}
</code></pre>
<h2>Handling Events</h2>
<h3>Handler Naming</h3>
<p>Event handlers include &quot;Handler&quot; in the business activity:</p>
<pre><code class="language-aro">(Feature Name: EventName Handler)
</code></pre>
<p>Examples:</p>
<pre><code class="language-aro">(Index Content: FileCreated Handler) { ... }
(Reload Config: FileModified Handler) { ... }
(Echo Data: DataReceived Handler) { ... }
(Log Connection: ClientConnected Handler) { ... }
</code></pre>
<h3>Accessing Event Data</h3>
<p>Use <code>&lt;Extract&gt;</code> to get event data:</p>
<pre><code class="language-aro">(Process Upload: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Extract&gt; the &lt;filename&gt; from the &lt;event: filename&gt;.

    &lt;Read&gt; the &lt;content&gt; from the &lt;file: path&gt;.
    &lt;Transform&gt; the &lt;processed&gt; from the &lt;content&gt;.
    &lt;Store&gt; the &lt;processed&gt; into the &lt;processed-repository&gt;.

    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;processing&gt;.
}
</code></pre>
<h3>Multiple Handlers</h3>
<p>Multiple handlers can respond to the same event:</p>
<pre><code class="language-aro">(* Handler 1: Log the file *)
(Log Upload: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Log&gt; the &lt;message&gt; for the &lt;console&gt; with &quot;File uploaded: ${path}&quot;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;logging&gt;.
}

(* Handler 2: Index the file *)
(Index Upload: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Read&gt; the &lt;content&gt; from the &lt;file: path&gt;.
    &lt;Store&gt; the &lt;index-entry&gt; into the &lt;search-index&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;indexing&gt;.
}

(* Handler 3: Notify admin *)
(Notify Upload: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Send&gt; the &lt;notification&gt; to the &lt;admin-channel&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;notification&gt;.
}
</code></pre>
<p>All handlers execute independently when the event is emitted.</p>
<h2>Built-in Events</h2>
<h3>Application Events</h3>
<table>
<thead>
<tr>
<th>Event</th>
<th>When Triggered</th>
</tr>
</thead>
<tbody><tr>
<td><code>ApplicationStarted</code></td>
<td>After Application-Start completes</td>
</tr>
<tr>
<td><code>ApplicationStopping</code></td>
<td>Before Application-End runs</td>
</tr>
</tbody></table>
<h3>File Events</h3>
<table>
<thead>
<tr>
<th>Event</th>
<th>When Triggered</th>
</tr>
</thead>
<tbody><tr>
<td><code>FileCreated</code></td>
<td>File created in watched directory</td>
</tr>
<tr>
<td><code>FileModified</code></td>
<td>File modified in watched directory</td>
</tr>
<tr>
<td><code>FileDeleted</code></td>
<td>File deleted in watched directory</td>
</tr>
<tr>
<td><code>FileRenamed</code></td>
<td>File renamed in watched directory</td>
</tr>
</tbody></table>
<h3>Socket Events</h3>
<table>
<thead>
<tr>
<th>Event</th>
<th>When Triggered</th>
</tr>
</thead>
<tbody><tr>
<td><code>ClientConnected</code></td>
<td>TCP client connects</td>
</tr>
<tr>
<td><code>DataReceived</code></td>
<td>Data received from client</td>
</tr>
<tr>
<td><code>ClientDisconnected</code></td>
<td>TCP client disconnects</td>
</tr>
</tbody></table>
<h2>Long-Running Applications</h2>
<p>For applications that need to stay alive to process events (servers, file watchers, etc.), use the <code>&lt;Keepalive&gt;</code> action:</p>
<pre><code class="language-aro">(Application-Start: File Watcher) {
    &lt;Log&gt; the &lt;startup: message&gt; for the &lt;console&gt; with &quot;Starting file watcher...&quot;.

    (* Start watching a directory *)
    &lt;Watch&gt; the &lt;directory: &quot;./uploads&quot;&gt; as &lt;file-monitor&gt;.

    (* Keep the application running to process file events *)
    &lt;Keepalive&gt; the &lt;application&gt; for the &lt;events&gt;.

    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;startup&gt;.
}
</code></pre>
<p>The <code>&lt;Keepalive&gt;</code> action:</p>
<ul>
<li>Blocks execution until a shutdown signal is received (SIGINT/SIGTERM)</li>
<li>Allows the event loop to process incoming events</li>
<li>Enables graceful shutdown with Ctrl+C</li>
</ul>
<h2>Best Practices</h2>
<h3>Keep Handlers Focused</h3>
<pre><code class="language-aro">(* Good - single responsibility *)
(Log File Upload: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.
    &lt;Log&gt; the &lt;message&gt; for the &lt;console&gt; with &quot;Uploaded: ${path}&quot;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;logging&gt;.
}

(* Avoid - too many responsibilities *)
(Handle File: FileCreated Handler) {
    (* Don&#39;t do logging, indexing, notifications, and analytics in one handler *)
}
</code></pre>
<h3>Handle Events Idempotently</h3>
<p>Events may be delivered multiple times:</p>
<pre><code class="language-aro">(Process File: FileCreated Handler) {
    &lt;Extract&gt; the &lt;path&gt; from the &lt;event: path&gt;.

    (* Check if already processed *)
    &lt;Retrieve&gt; the &lt;existing&gt; from the &lt;processed-files&gt; where path = &lt;path&gt;.

    if &lt;existing&gt; is not empty then {
        (* Already processed - skip *)
        &lt;Return&gt; an &lt;OK: status&gt; for the &lt;idempotent&gt;.
    }

    (* Process file *)
    &lt;Read&gt; the &lt;content&gt; from the &lt;file: path&gt;.
    &lt;Transform&gt; the &lt;processed&gt; from the &lt;content&gt;.
    &lt;Store&gt; the &lt;processed&gt; into the &lt;processed-files&gt;.
    &lt;Return&gt; an &lt;OK: status&gt; for the &lt;processing&gt;.
}
</code></pre>
<h2>Next Steps</h2>
<ul>
<li><a href="applicationlifecycle.html">Application Lifecycle</a> - Startup and shutdown events</li>
<li><a href="httpservices.html">HTTP Services</a> - Contract-first HTTP routing</li>
<li><a href="filesystem.html">File System</a> - File system events</li>
</ul>

    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Sometime this page should build with ARO. Obviously.</p>
            </div>
        </div>
    </footer>
</body>
</html>
