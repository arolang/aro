<!DOCTYPE html>
<html lang="en">
<head>
    <title>Native Compilation - ARO Programming Language</title>
{{head}}
    <style>
        .doc-page {
            padding: 120px 24px 80px;
            max-width: 900px;
            margin: 0 auto;
        }

        .doc-header {
            margin-bottom: 48px;
        }

        .doc-header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .doc-header .lead {
            font-size: 1.25rem;
            color: var(--color-text-muted);
            line-height: 1.7;
        }

        .doc-page h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 48px 0 16px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .doc-page h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 32px 0 12px;
            color: var(--color-secondary);
        }

        .doc-page p {
            font-size: 1.1rem;
            color: var(--color-text-muted);
            line-height: 1.8;
            margin-bottom: 16px;
        }

        .doc-page code {
            font-family: var(--font-mono);
            background: var(--color-bg-alt);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--color-secondary);
        }

        .doc-page pre {
            background: var(--color-bg-alt);
            border-radius: var(--radius-md);
            padding: 24px;
            overflow-x: auto;
            margin: 24px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .doc-page pre code {
            background: none;
            padding: 0;
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--color-text);
        }

        .doc-page ul {
            color: var(--color-text-muted);
            margin: 16px 0 16px 24px;
            line-height: 1.8;
        }

        .doc-page li {
            margin-bottom: 8px;
        }

        .doc-page strong {
            color: var(--color-text);
        }

        .doc-page em {
            color: var(--color-secondary);
            font-style: normal;
        }

        .highlight-box {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: var(--radius-md);
            padding: 24px;
            margin: 32px 0;
        }

        .highlight-box h4 {
            color: var(--color-primary);
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        .highlight-box p {
            margin-bottom: 0;
        }

        .pipeline-visual {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 32px 0;
            padding: 24px;
            background: var(--color-bg-alt);
            border-radius: var(--radius-md);
        }

        .pipeline-step {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid var(--color-secondary);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--color-secondary);
            text-align: center;
        }

        .pipeline-arrow {
            color: var(--color-text-muted);
            font-size: 1.5rem;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }

        .benefit-card {
            background: var(--color-bg-alt);
            padding: 24px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .benefit-card h4 {
            color: var(--color-text);
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .benefit-card p {
            font-size: 0.95rem;
            margin-bottom: 0;
        }

        .code-comment { color: #6b7280; }
        .code-keyword { color: #7c3aed; font-weight: 600; }
        .code-string { color: #10b981; }
        .code-feature { color: #f472b6; }
        .code-result { color: #06b6d4; }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--color-text-muted);
            text-decoration: none;
            font-size: 0.95rem;
            margin-bottom: 24px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--color-primary);
        }

        .terminal {
            background: #1a1a2e;
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 24px 0;
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }

        .terminal-prompt {
            color: #10b981;
        }

        .terminal-command {
            color: var(--color-text);
        }

        .terminal-output {
            color: var(--color-text-muted);
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-content">
            <a href="/aro/" class="logo">
                <span class="logo-aro">ARO</span>
            </a>
            <div class="nav-links">
                <a href="../fdd.html">The FDD Story</a>
                <a href="../getting-started.html">Get Started</a>
                <a href="../docs.html" style="color: var(--color-text);">Docs</a>
                <a href="../disclaimer.html">Motivation</a>
                <a href="../download.html">Download</a>
                <a href="https://github.com/arolang/aro" class="nav-github">
                    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                    <span class="github-stars">
                        <svg viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"/></svg>
                        <span class="github-stars-count"></span>
                    </span>
                </a>
            </div>
        </div>
    </nav>

    <main class="doc-page">
        <a href="../docs.html" class="back-link">&#x2190; Back to Documentation</a>

        <header class="doc-header">
            <h1 class="gradient-text">Native Compilation</h1>
            <p class="lead">
                Compile ARO applications to native binaries via LLVM IR.
                Deploy standalone executables with fast startup, low memory footprint,
                and full access to runtime services.
            </p>
        </header>

        <div class="highlight-box">
            <h4>Two Modes: Development and Production</h4>
            <p>
                Use <code>aro run</code> for rapid development with the interpreter.
                Use <code>aro build</code> for production-ready native binaries.
            </p>
        </div>

        <h2>Compilation Pipeline</h2>
        <p>
            ARO compiles through LLVM for maximum performance and portability:
        </p>

        <div class="pipeline-visual">
            <span class="pipeline-step">.aro files</span>
            <span class="pipeline-arrow">&#x2192;</span>
            <span class="pipeline-step">Parser<br/>&#x2193;<br/>AST</span>
            <span class="pipeline-arrow">&#x2192;</span>
            <span class="pipeline-step">LLVM IR<br/>(.ll)</span>
            <span class="pipeline-arrow">&#x2192;</span>
            <span class="pipeline-step">Object<br/>(.o)</span>
            <span class="pipeline-arrow">&#x2192;</span>
            <span class="pipeline-step">Native<br/>Binary</span>
        </div>

        <h2>Basic Usage</h2>

        <div class="terminal">
            <span class="terminal-prompt">$</span> <span class="terminal-command">aro build ./MyApp</span>
            <div class="terminal-output">
                Compiling main.aro...<br/>
                Compiling users.aro...<br/>
                Generating LLVM IR...<br/>
                Linking with runtime...<br/>
                Build complete: ./MyApp/MyApp
            </div>
        </div>

        <p>
            The result is a standalone executable that can be deployed without the ARO interpreter.
        </p>

        <h2>Build Options</h2>

        <pre><code><span class="code-comment"># Basic build</span>
aro build ./MyApp

<span class="code-comment"># Enable optimizations</span>
aro build ./MyApp --optimize

<span class="code-comment"># Emit LLVM IR for inspection</span>
aro build ./MyApp --emit-llvm

<span class="code-comment"># Verbose output</span>
aro build ./MyApp --verbose

<span class="code-comment"># Keep intermediate files (.ll, .o)</span>
aro build ./MyApp --keep-intermediate</code></pre>

        <h2>Benefits</h2>

        <div class="benefits-grid">
            <div class="benefit-card">
                <h4>Fast Startup</h4>
                <p>No interpreter initialization. Your app starts immediately.</p>
            </div>
            <div class="benefit-card">
                <h4>Lower Memory</h4>
                <p>No interpreter runtime in memory. Just your code and the runtime bridge.</p>
            </div>
            <div class="benefit-card">
                <h4>Single Binary</h4>
                <p>Deploy one executable file. No dependencies to manage.</p>
            </div>
            <div class="benefit-card">
                <h4>Cross-Platform</h4>
                <p>LLVM targets macOS (arm64, x86_64) and Linux (x86_64, arm64).</p>
            </div>
        </div>

        <h2>How It Works</h2>

        <h3>1. LLVM Code Generation</h3>
        <p>
            Each feature set becomes an LLVM function. ARO statements become calls to runtime bridge functions:
        </p>

        <pre><code><span class="code-comment">; Feature Set: Application-Start</span>
define ptr @aro_fs_application_start(ptr %ctx) {
entry:
  <span class="code-comment">; Create the &lt;greeting&gt; with "Hello, World!"</span>
  call void @aro_variable_bind_string(ptr %ctx, ...)
  %result = call ptr @aro_action_create(ptr %ctx, ...)

  <span class="code-comment">; Log the &lt;greeting&gt; for the &lt;console&gt;</span>
  call ptr @aro_action_log(ptr %ctx, ...)

  <span class="code-comment">; Return an &lt;OK: status&gt;</span>
  call ptr @aro_action_return(ptr %ctx, ...)

  ret ptr %result
}</code></pre>

        <h3>2. Runtime Bridge</h3>
        <p>
            The compiled binary links with <code>libAROCRuntime.a</code>, a Swift static library
            that provides all runtime services:
        </p>

        <ul>
            <li><strong>All 50 built-in actions</strong> via <code>@_cdecl</code> functions</li>
            <li><strong>HTTP server/client</strong> powered by SwiftNIO</li>
            <li><strong>File system operations</strong> with file monitoring</li>
            <li><strong>TCP socket server/client</strong></li>
            <li><strong>Event bus</strong> for inter-feature communication</li>
        </ul>

        <h3>3. Entry Point Generation</h3>
        <p>
            The <code>Application-Start</code> feature set automatically generates the <code>main()</code> entry point:
        </p>

        <pre><code>define i32 @main(i32 %argc, ptr %argv) {
entry:
  %runtime = call ptr @aro_runtime_init()
  %ctx = call ptr @aro_context_create_named(%runtime, ...)
  %result = call ptr @aro_fs_application_start(%ctx)
  call void @aro_runtime_shutdown(%runtime)
  ret i32 0
}</code></pre>

        <h2>Output Structure</h2>

        <pre><code>MyApp/
&#x251C;&#x2500;&#x2500; main.aro           <span class="code-comment"># Source files</span>
&#x251C;&#x2500;&#x2500; users.aro
&#x251C;&#x2500;&#x2500; openapi.yaml
&#x251C;&#x2500;&#x2500; <strong>MyApp</strong>              <span class="code-comment"># Final executable</span>
&#x2514;&#x2500;&#x2500; .build/
    &#x251C;&#x2500;&#x2500; MyApp.ll       <span class="code-comment"># LLVM IR (if --keep-intermediate)</span>
    &#x2514;&#x2500;&#x2500; MyApp.o        <span class="code-comment"># Object file (if --keep-intermediate)</span></code></pre>

        <h2>Platform Support</h2>

        <ul>
            <li><strong>macOS</strong>: arm64 (Apple Silicon), x86_64 (Intel)</li>
            <li><strong>Linux</strong>: x86_64, arm64</li>
        </ul>

        <h3>Requirements</h3>
        <ul>
            <li>LLVM toolchain (<code>brew install llvm</code> on macOS)</li>
            <li>C compiler (clang preferred)</li>
            <li>Swift toolchain (for building AROCRuntime)</li>
        </ul>

        <h2>Development vs Production</h2>

        <pre><code><span class="code-comment"># Development: Use the interpreter for fast iteration</span>
aro run ./MyApp

<span class="code-comment"># Production: Compile to native binary</span>
aro build ./MyApp --optimize
./MyApp/MyApp</code></pre>

        <p>
            Both modes produce identical behavior. The interpreter is perfect for development,
            while native binaries are ideal for deployment.
        </p>

        <div class="highlight-box">
            <h4>Learn More</h4>
            <p>
                See the full native compilation specification in
                <a href="https://github.com/arolang/aro/blob/main/Proposals/ARO-0026-native-compilation.md">ARO-0026: Native Compilation</a>.
            </p>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Sometime this page should build with ARO. Obviously.</p>
            </div>
        </div>
    </footer>
</body>
</html>
